- Java堆溢出

```java
import java.util.ArrayList;
import java.util.List;

/**
 * VM Args: -Xmx20M -Xms20M -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/
 *
 * @author lishaofei
 * @version 1.0 2019/06/19
 */
public class HeapOOM {

    static class OOMObject {

    }

    public static void main(String[] args) {
        List<OOMObject> list = new ArrayList<>();
        while (true) {
            list.add(new OOMObject());
        }
    }

}
```

---

- 虚拟机栈及本地方法栈溢出

```java
/**
 * VM Args: -Xss256k
 *
 * @author lishaofei
 * @version 1.0 2019/06/19
 */
public class JavaVMStackSOF {

    private int stackLength = 1;

    public int getStackLength() {
        return stackLength;
    }

    public void setStackLength(int stackLength) {
        this.stackLength = stackLength;
    }

    public void stackLeak() {
        stackLength++;
        stackLeak();
    }

    public static void main(String[] args) throws Throwable {
        JavaVMStackSOF oom = new JavaVMStackSOF();
        try {
            oom.stackLeak();
        } catch (Throwable t) {
            System.out.println("stackLength:" + oom.getStackLength());
            throw t;
        }
    }

}
```

```java
/**
 * VM Args: -Xss2M
 *
 * @author lishaofei
 * @version 1.0 2019/06/19
 */
public class JavaVMStackOOM {

    private void dontStop() {
        while (true) {
        }
    }

    public void stackLeakByThread() {
        while (true) {
            Thread thread = new Thread(new Runnable() {
                @Override
                public void run() {
                    dontStop();
                }
            });
            thread.start();
        }
    }

    public static void main(String[] args) throws Throwable {
        JavaVMStackOOM oom = new JavaVMStackOOM();
        oom.stackLeakByThread();
    }

}
```

```java
public static void main(String[] args) {
    String str1 = new StringBuilder("abc").append("def").toString();
    System.out.println(str1.intern() == str1);
    String str2 = new StringBuilder("ja").append("va").toString();
    System.out.println(str2.intern() == str2);
}
```

```java
public class RuntimeConstantPoolOOM {

    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        int i = 0;
        while (true) {
            list.add(String.valueOf(i++).intern());
        }
    }

}
```

```java
public class JavaMethodAreaOOM {

    public static void main(String[] args) throws Throwable {
        while (true) {
            Enhancer enhancer = new Enhancer();
            enhancer.setSuperclass(MethodAreaOOMObject.class);
            enhancer.setUseCache(false);
            enhancer.setCallback(new MethodInterceptor() {
                @Override
                public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
                    return methodProxy.invokeSuper(o, objects);
                }
            });
            enhancer.create();
        }
    }

    static class MethodAreaOOMObject {

    }

}
```

```java
public class JavaDirectMemoryOOM {

    private static final int _1MB = 1024*1024;

    public static void main(String[] args) throws Throwable {
        Field unsafeField = Unsafe.class.getDeclaredFields()[0];
        unsafeField.setAccessible(true);
        Unsafe unsafe = (Unsafe) unsafeField.get(null);
        while (true){
            unsafe.allocateMemory(_1MB);
        }

    }

}
```